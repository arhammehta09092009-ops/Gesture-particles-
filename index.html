<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Gesture Particles</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #0b0e14;
}
#start {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: system-ui;
  color: #cfd8ff;
  background: #0b0e14;
  z-index: 10;
}
</style>
</head>

<body>

<div id="start">Tap to start</div>

<!-- MediaPipe (NON-MODULE, REQUIRED) -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js"></script>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';

const start = document.getElementById('start');

start.addEventListener('click', async () => {
  start.remove();

  /* THREE */
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
  camera.position.z = 5;

  const renderer = new THREE.WebGLRenderer({ alpha:true });
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  const g = new THREE.BufferGeometry();
  const count = 2000;
  const pos = new Float32Array(count * 3);

  for (let i=0;i<count;i++){
    pos[i*3]=(Math.random()-.5)*3;
    pos[i*3+1]=(Math.random()-.5)*3;
    pos[i*3+2]=(Math.random()-.5)*3;
  }

  g.setAttribute('position', new THREE.BufferAttribute(pos,3));
  const p = new THREE.Points(g,new THREE.PointsMaterial({size:.03,color:0x88aaff}));
  scene.add(p);

  /* MEDIAPIPE */
  const hands = new Hands({
    locateFile: f =>
      `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${f}`
  });

  hands.setOptions({ maxNumHands:1 });

  const video = document.createElement('video');
  const cam = new Camera(video, {
    onFrame: async () => await hands.send({ image: video }),
    width: 640,
    height: 480
  });

  hands.onResults(() => p.rotation.y += 0.1);

  cam.start();

  function animate(){
    requestAnimationFrame(animate);
    renderer.render(scene,camera);
  }
  animate();
});
</script>

</body>
</html>
